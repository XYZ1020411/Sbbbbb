<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>兌換系統</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #ffcccc; /* 淡紅色背景 */
            color: #333;
            margin: 0;
            padding: 0;
        }
        .container {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            margin: 20px auto;
            padding: 20px;
            max-width: 400px;
        }
        h2 {
            text-align: center;
            color: #b30000; /* 深紅色 */
        }
        input[type="text"],
        input[type="number"],
        input[type="password"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #FFD700; /* 金黃色按鈕 */
            color: black;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin: 5px 0;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #FFC300; /* 更深的金黃色 */
        }
        .hidden { display: none; }
        #customerMessage {
            margin-top: 10px;
            color: #d9534f; /* 鮮紅色錯誤訊息 */
        }
        .cart-item {
            background: #e6ffe6; /* 淡綠色背景 */
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        #scratchCard {
            background: #f0f0f0;
            padding: 20px;
            text-align: center;
            margin-top: 10px;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }
        #scratchResult {
            margin-top: 10px;
            font-weight: bold;
        }
        .scratch-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            background: gray;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container" id="loginContainer">
        <h2>登錄</h2>
        <input type="text" id="username" placeholder="用戶名">
        <input type="password" id="password" placeholder="密碼">
        <button onclick="login()">登錄</button>
        <button onclick="toggleVisibility('registerContainer', true)">註冊</button>
    </div>

    <div class="container hidden" id="registerContainer">
        <h2>註冊</h2>
        <input type="text" id="newUsername" placeholder="用戶名">
        <input type="password" id="newPassword" placeholder="密碼">
        <button onclick="register()">註冊</button>
        <button onclick="toggleVisibility('registerContainer', false)">返回登錄</button>
    </div>

    <div class="container hidden" id="customerContainer">
        <h2>客戶功能</h2>
        <button id="checkInButton" onclick="checkIn()">每日簽到</button>
        <button id="viewPointsButton" onclick="viewPoints()">查看點數</button>
        <h3>可兌換物品</h3>
        <div id="redeemItemsContainer"></div>
        <h3>購物車</h3>
        <div id="cartContainer"></div>
        <button onclick="checkout()">結帳</button>
        <h3>刮刮樂</h3>
        <div id="scratchCard">
            <div class="scratch-layer" onclick="scratchCard(event)"></div>
            <div id="scratchResult"></div>
        </div>
        <input type="text" id="redeemCode" placeholder="輸入兌換碼">
        <button onclick="redeemWithCode()">兌換碼兌換</button>
        <h3>收件夾</h3>
        <ul id="inboxList"></ul>
        <p id="customerMessage"></p>
    </div>

    <div class="container hidden" id="adminContainer">
        <h2>管理員功能</h2>
        <button onclick="viewUsers()">查看所有用戶</button>
        <input type="text" id="newRedeemCode" placeholder="輸入新兌換碼">
        <input type="number" id="points" placeholder="增加點數" min="1">
        <button onclick="addRedeemCode()">新增兌換碼</button>
        <h3>新增可兌換物品</h3>
        <input type="text" id="itemName" placeholder="新增可兌換物品名稱">
        <input type="number" id="itemCost" placeholder="物品所需點數" min="1">
        <button onclick="addRedeemItem()">新增可兌換物品</button>
        <h3>刪除可兌換物品</h3>
        <input type="text" id="deleteItemName" placeholder="輸入要刪除的物品名稱">
        <button onclick="deleteRedeemItem()">刪除可兌換物品</button>
        <h3>物品使用碼</h3>
        <input type="text" id="itemUsageCode" placeholder="輸入物品使用碼">
        <button onclick="useItemCode()">使用碼</button>
        <h3>通知列表</h3>
        <ul id="notificationList"></ul>
        <ul id="userList" class="hidden"></ul>
    </div>

    <script>
        let currentUser = null;
        let redeemItems = {
            "商品A": { cost: 20, used: false },
            "商品B": { cost: 50, used: false },
            "商品C": { cost: 30, used: false }
        };
        let cart = []; // 購物車陣列
        let registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || {};
        let inbox = JSON.parse(localStorage.getItem('inbox')) || {};

        function toggleVisibility(containerId, isVisible) {
            document.getElementById(containerId).classList.toggle('hidden', !isVisible);
        }

        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!username || !password) {
                alert("請輸入用戶名和密碼！");
                return;
            }

            const adminUsername = "admin";
            const adminPassword = "xyz1020411";

            if (username === adminUsername && password === adminPassword) {
                currentUser = { username, points: 100, isAdmin: true };
            } else {
                if (registeredUsers[username] && registeredUsers[username].password === password) {
                    currentUser = { username, ...registeredUsers[username] };
                } else {
                    alert("用戶名或密碼錯誤！");
                    return;
                }
            }

            toggleVisibility('loginContainer', false);
            toggleVisibility(currentUser.isAdmin ? 'adminContainer' : 'customerContainer', true);
            displayRedeemItems();
        }

        function register() {
            const username = document.getElementById('newUsername').value.trim();
            const password = document.getElementById('newPassword').value.trim();

            if (!username || !password) {
                alert("請輸入用戶名和密碼！");
                return;
            }

            if (registeredUsers[username]) {
                alert("用戶名已存在，請選擇其他用戶名！");
                return;
            }

            registeredUsers[username] = { password, points: 0, lastCheckIn: null };
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
            alert("註冊成功！您現在可以登錄。");
            toggleVisibility('registerContainer', false);
        }

        function viewPoints() {
            alert(`您的當前點數: ${currentUser.points}`);
        }

        function displayRedeemItems() {
            const container = document.getElementById('redeemItemsContainer');
            container.innerHTML = ""; // 清空容器
            for (const [itemName, itemData] of Object.entries(redeemItems)) {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'redeem-item';
                itemDiv.textContent = `${itemName} - ${itemData.cost} 點數 (${itemData.used ? '已使用' : '未使用'})`;
                itemDiv.onclick = () => addToCart(itemName, itemData.cost);
                container.appendChild(itemDiv);
            }
        }

        function addToCart(itemName, itemCost) {
            if (currentUser.points < itemCost) {
                document.getElementById('customerMessage').innerText = "點數不足，無法加入購物車！";
                return;
            }
            cart.push({ name: itemName, cost: itemCost });
            displayCart();
            document.getElementById('customerMessage').innerText = `${itemName} 已加入購物車！`;
        }

        function displayCart() {
            const cartContainer = document.getElementById('cartContainer');
            cartContainer.innerHTML = ""; // 清空購物車容器
            cart.forEach(item => {
                const cartItemDiv = document.createElement('div');
                cartItemDiv.className = 'cart-item';
                cartItemDiv.textContent = `${item.name} - ${item.cost} 點數`;
                cartContainer.appendChild(cartItemDiv);
            });
        }

        function checkout() {
            if (cart.length === 0) {
                document.getElementById('customerMessage').innerText = "購物車是空的！";
                return;
            }
            let totalCost = cart.reduce((sum, item) => sum + item.cost, 0);
            if (currentUser.points < totalCost) {
                document.getElementById('customerMessage').innerText = "點數不足，無法結帳！";
                return;
            }
            cart.forEach(item => {
                currentUser.points -= item.cost;
                redeemItems[item.name].used = true; // 標記為已使用
                const usageCode = generateUsageCode(); // 生成使用碼
                document.getElementById('customerMessage').innerText += `成功兌換 ${item.name}！您的使用碼是: ${usageCode}（已使用）\n`;
            });
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
            cart = []; // 清空購物車
            displayCart(); // 更新購物車顯示
            displayRedeemItems(); // 更新可兌換物品顯示
        }

        function generateUsageCode() {
            return Math.random().toString(36).substring(2, 10).toUpperCase(); // 隨機生成使用碼
        }

        function redeemWithCode() {
            const code = document.getElementById('redeemCode').value.trim();
            if (code) {
                if (code === "DISCOUNT10") {
                    currentUser.points += 10; // 兌換碼增加10點
                    alert("兌換碼使用成功，獲得10點數！");
                    localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                } else {
                    alert("無效的兌換碼！");
                }
            }
        }

        // 刮刮樂功能
        function scratchCard(event) {
            const scratchLayer = document.querySelector('.scratch-layer');
            scratchLayer.style.background = 'transparent'; // 刮開後變透明

            const prizes = [
                { type: "點數", amount: 10 },
                { type: "點數", amount: 20 },
                { type: "點數", amount: 50 },
                { type: "獎品", name: "神秘禮物" },
                { type: "無獎", amount: 0 }
            ];
            const randomIndex = Math.floor(Math.random() * prizes.length);
            const prize = prizes[randomIndex];

            let resultMessage = "";
            if (prize.type === "點數") {
                currentUser.points += prize.amount;
                resultMessage = `恭喜！您贏得了 ${prize.amount} 點數！`;
            } else if (prize.type === "獎品") {
                resultMessage = `恭喜！您贏得了 ${prize.name}！`;
            } else {
                resultMessage = "很遺憾，您沒有贏得任何獎品。";
            }

            document.getElementById('scratchResult').innerText = resultMessage;
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
        }

        // 管理員功能
        function viewUsers() {
            const userList = document.getElementById('userList');
            userList.innerHTML = ""; // 清空用戶列表
            for (const username in registeredUsers) {
                const userItem = document.createElement('li');
                userItem.textContent = `${username} - 點數: ${registeredUsers[username].points}`;
                userList.appendChild(userItem);
            }
            toggleVisibility('userList', true);
        }

        function addRedeemCode() {
            const newCode = document.getElementById('newRedeemCode').value.trim();
            const pointsToAdd = parseInt(document.getElementById('points').value);
            if (newCode && pointsToAdd > 0) {
                alert(`新增兌換碼 ${newCode}，可獲得 ${pointsToAdd} 點數！`);
            } else {
                alert("請輸入有效的兌換碼和點數！");
            }
        }

        function addRedeemItem() {
            const itemName = document.getElementById('itemName').value.trim();
            const itemCost = parseInt(document.getElementById('itemCost').value);
            if (itemName && itemCost > 0) {
                redeemItems[itemName] = { cost: itemCost, used: false };
                alert(`新增可兌換物品 ${itemName}，所需點數: ${itemCost}`);
                displayRedeemItems();
            } else {
                alert("請輸入有效的物品名稱和點數！");
            }
        }

        function deleteRedeemItem() {
            const itemName = document.getElementById('deleteItemName').value.trim();
            if (itemName in redeemItems) {
                delete redeemItems[itemName];
                alert(`刪除可兌換物品 ${itemName}`);
                displayRedeemItems();
            } else {
                alert("物品不存在！");
            }
        }

        function useItemCode() {
            const code = document.getElementById('itemUsageCode').value.trim();
            if (code) {
                alert(`使用碼 ${code} 已被使用！`);
                // 在這裡可以添加使用碼的邏輯
            } else {
                alert("請輸入有效的使用碼！");
            }
        }
    </script>
</body>
</html>
