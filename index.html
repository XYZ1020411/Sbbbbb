<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>兌換系統</title>
    <style>
        body { font-family: Arial; background: #ffcccc; color: #333; margin: 0; padding: 0; }
        .container { background: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2); margin: 20px auto; padding: 20px; max-width: 400px; }
        h2 { text-align: center; color: #b30000; }
        input, button { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; }
        button { background: #FFD700; color: black; border: none; cursor: pointer; transition: background 0.3s; }
        button:hover { background: #FFC300; }
        .hidden { display: none; }
        .cart-item { background: #e6ffe6; padding: 10px; margin: 5px 0; border-radius: 4px; }
        #scratchCard { background: #f0f0f0; padding: 20px; text-align: center; margin-top: 10px; border-radius: 8px; position: relative; }
        .scratch-layer { position: absolute; width: 100%; height: 100%; background: gray; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container" id="loginContainer">
        <h2>登錄</h2>
        <input type="text" id="username" placeholder="用戶名">
        <input type="password" id="password" placeholder="密碼">
        <button onclick="login()">登錄</button>
        <button onclick="toggleVisibility('registerContainer', true)">註冊</button>
    </div>

    <div class="container hidden" id="registerContainer">
        <h2>註冊</h2>
        <input type="text" id="newUsername" placeholder="用戶名">
        <input type="password" id="newPassword" placeholder="密碼">
        <button onclick="register()">註冊</button>
        <button onclick="toggleVisibility('registerContainer', false)">返回登錄</button>
    </div>

    <div class="container hidden" id="customerContainer">
        <h2>客戶功能</h2>
        <button onclick="checkIn()">每日簽到</button>
        <button onclick="viewPoints()">查看點數</button>
        <h3>可兌換物品</h3>
        <div id="redeemItemsContainer"></div>
        <h3>購物車</h3>
        <div id="cartContainer"></div>
        <button onclick="checkout()">結帳</button>
        <h3>刮刮樂</h3>
        <div id="scratchCard">
            <div class="scratch-layer" onclick="scratchCard(event)"></div>
            <div id="scratchResult"></div>
        </div>
        <input type="text" id="redeemCode" placeholder="輸入兌換碼">
        <button onclick="redeemWithCode()">兌換碼兌換</button>
        <p id="customerMessage"></p>
    </div>

    <div class="container hidden" id="adminContainer">
        <h2>管理員功能</h2>
        <button onclick="viewUsers()">查看所有用戶</button>
        <input type="text" id="newRedeemCode" placeholder="輸入新兌換碼">
        <input type="number" id="points" placeholder="增加點數" min="1">
        <button onclick="addRedeemCode()">新增兌換碼</button>
        <h3>新增可兌換物品</h3>
        <input type="text" id="itemName" placeholder="物品名稱">
        <input type="number" id="itemCost" placeholder="所需點數" min="1">
        <button onclick="addRedeemItem()">新增物品</button>
        <h3>刪除可兌換物品</h3>
        <input type="text" id="deleteItemName" placeholder="物品名稱">
        <button onclick="deleteRedeemItem()">刪除物品</button>
    </div>

    <script>
        let currentUser = null, redeemItems = { "商品A": { cost: 20 }, "商品B": { cost: 50 }, "商品C": { cost: 30 } }, cart = [], registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || {};

        function toggleVisibility(containerId, isVisible) {
            document.getElementById(containerId).classList.toggle('hidden', !isVisible);
        }

        function login() {
            const username = document.getElementById('username').value.trim(), password = document.getElementById('password').value.trim();
            if (!username || !password) return alert("請輸入用戶名和密碼！");
            const adminUsername = "xyz1020411", adminPassword = "xyz1020411";
            if (username === adminUsername && password === adminPassword) currentUser = { username, points: 100, isAdmin: true };
            else if (registeredUsers[username]?.password === password) currentUser = { username, ...registeredUsers[username] };
            else return alert("用戶名或密碼錯誤！");
            toggleVisibility('loginContainer', false);
            toggleVisibility(currentUser.isAdmin ? 'adminContainer' : 'customerContainer', true);
            displayRedeemItems();
        }

        function register() {
            const username = document.getElementById('newUsername').value.trim(), password = document.getElementById('newPassword').value.trim();
            if (!username || !password) return alert("請輸入用戶名和密碼！");
            if (registeredUsers[username]) return alert("用戶名已存在！");
            registeredUsers[username] = { password, points: 0 };
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
            alert("註冊成功！");
            toggleVisibility('registerContainer', false);
        }

        function checkIn() {
            const today = new Date().toDateString();
            if (currentUser.lastCheckIn === today) return alert("您今天已經簽到過了！");
            currentUser.points += 20; currentUser.lastCheckIn = today;
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
            alert("簽到成功！您獲得了20點數！");
        }

        function viewPoints() {
            alert(`您的當前點數: ${currentUser.points}`);
        }

        function displayRedeemItems() {
            const container = document.getElementById('redeemItemsContainer');
            container.innerHTML = Object.entries(redeemItems).map(([name, { cost }]) => `<div onclick="addToCart('${name}', ${cost})">${name} - ${cost} 點數</div>`).join('');
        }

        function addToCart(itemName, itemCost) {
            if (currentUser.points < itemCost) return alert("點數不足！");
            cart.push({ name: itemName, cost: itemCost });
            displayCart();
            alert(`${itemName} 已加入購物車！`);
        }

        function displayCart() {
            document.getElementById('cartContainer').innerHTML = cart.map(item => `<div class="cart-item">${item.name} - ${item.cost} 點數</div>`).join('');
        }

        function checkout() {
            if (!cart.length) return alert("購物車是空的！");
            const totalCost = cart.reduce((sum, item) => sum + item.cost, 0);
            if (currentUser.points < totalCost) return alert("點數不足，無法結帳！");
            cart.forEach(item => { currentUser.points -= item.cost; redeemItems[item.name].used = true; });
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
            alert("結帳成功！");
            cart = [];
            displayCart();
            displayRedeemItems();
        }

        function redeemWithCode() {
            const code = document.getElementById('redeemCode').value.trim();
            if (registeredUsers[code]) {
                currentUser.points += registeredUsers[code].points;
                alert(`兌換碼使用成功，獲得 ${registeredUsers[code].points} 點數！`);
                delete registeredUsers[code];
                localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
            } else alert("無效的兌換碼！");
        }

        function viewUsers() {
            const userList = document.getElementById('userList');
            userList.innerHTML = Object.entries(registeredUsers).map(([username, { points }]) => `<li>${username} - 點數: ${points}</li>`).join('');
            toggleVisibility('userList', true);
        }

        function addRedeemCode() {
            const newCode = document.getElementById('newRedeemCode').value.trim(), pointsToAdd = parseInt(document.getElementById('points').value);
            if (newCode && pointsToAdd > 0) {
                registeredUsers[newCode] = { points: pointsToAdd };
                localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                alert(`新增兌換碼 ${newCode}，可獲得 ${pointsToAdd} 點數！`);
            } else alert("請輸入有效的兌換碼和點數！");
        }

        function addRedeemItem() {
            const itemName = document.getElementById('itemName').value.trim(), itemCost = parseInt(document.getElementById('itemCost').value);
            if (itemName && itemCost > 0) {
                redeemItems[itemName] = { cost: itemCost };
                alert(`新增可兌換物品 ${itemName}，所需點數: ${itemCost}`);
                displayRedeemItems();
            } else alert("請輸入有效的物品名稱和點數！");
        }

        function deleteRedeemItem() {
            const itemName = document.getElementById('deleteItemName').value.trim();
            if (itemName in redeemItems) {
                delete redeemItems[itemName];
                alert(`刪除可兌換物品 ${itemName}`);
                displayRedeemItems();
            } else alert("物品不存在！");
        }
    </script>
</body>
</html>
