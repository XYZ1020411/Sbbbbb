<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
<meta charset="UTF-8">
<style type="text/css">

</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
</head>
<body>
<!-- 只顯示修改部分的代碼，其他部分保持不變 -->

<script>
// ================= 新增功能實現 =================

// 每日簽到功能
document.getElementById('checkInBtn').addEventListener('click', function() {
    if (!currentUser) return;
    
    // 檢查今天是否已簽到
    const today = new Date().toLocaleDateString();
    if (currentUser.lastCheckIn === today) {
        alert('您今天已經簽到過了！');
        return;
    }
    
    // 隨機獎勵點數 (100-1000點)
    const rewardPoints = Math.floor(Math.random() * 901) + 100;
    currentUser.points += rewardPoints;
    currentUser.lastCheckIn = today;
    
    // 記錄交易
    const transaction = {
        type: 'check_in',
        amount: rewardPoints,
        date: new Date().toISOString()
    };
    
    if (!currentUser.transactions) {
        currentUser.transactions = [];
    }
    currentUser.transactions.push(transaction);
    
    alert(`簽到成功！獲得 ${rewardPoints} 點`);
    updateWalletDisplay();
    updateVipInfo();
});

// 查看VIP等級
document.getElementById('viewLevelsBtn').addEventListener('click', function() {
    const levels = [
        { level: 1, name: '普通會員', requiredPoints: 0, benefits: '基本功能' },
        { level: 2, name: '銀牌會員', requiredPoints: 10000, benefits: '每日額外獎勵' },
        { level: 3, name: '金牌會員', requiredPoints: 50000, benefits: '專屬客服' },
        { level: 4, name: '白金會員', requiredPoints: 200000, benefits: '所有VIP功能' }
    ];
    
    let levelHtml = '<h3>VIP等級說明</h3>';
    levels.forEach(lvl => {
        levelHtml += `
            <div class="level-description">
                <strong>${lvl.level}. ${lvl.name}</strong><br>
                所需點數: ${lvl.requiredPoints.toLocaleString()}<br>
                特權: ${lvl.benefits}
            </div>
        `;
    });
    
    alert(levelHtml);
});

// 兌換商品功能
document.getElementById('redeemItemsBtn').addEventListener('click', function() {
    const items = [
        { id: 1, name: '50元折價券', cost: 5000 },
        { id: 2, name: '100元折價券', cost: 10000 },
        { id: 3, name: 'VIP專屬禮品', cost: 50000 },
        { id: 4, name: '神秘大禮包', cost: 100000 }
    ];
    
    let itemsHtml = '<h3>可兌換商品</h3>';
    items.forEach(item => {
        itemsHtml += `
            <div class="cart-item">
                <strong>${item.name}</strong><br>
                所需點數: ${item.cost.toLocaleString()}
                <button class="redeem-item-btn" data-id="${item.id}" 
                    ${currentUser.points < item.cost ? 'disabled' : ''}>
                    兌換
                </button>
            </div>
        `;
    });
    
    const container = document.createElement('div');
    container.innerHTML = itemsHtml;
    
    // 顯示兌換界面
    alert(container.innerHTML);
    
    // 添加兌換按鈕事件
    document.querySelectorAll('.redeem-item-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const itemId = parseInt(this.getAttribute('data-id'));
            const item = items.find(i => i.id === itemId);
            
            if (currentUser.points < item.cost) {
                alert('點數不足！');
                return;
            }
            
            currentUser.points -= item.cost;
            
            // 記錄交易
            const transaction = {
                type: 'redeem',
                item: item.name,
                amount: -item.cost,
                date: new Date().toLocaleString()
            };
            
            if (!currentUser.transactions) {
                currentUser.transactions = [];
            }
            currentUser.transactions.push(transaction);
            
            // 添加到商品券
            if (!currentUser.vouchers) {
                currentUser.vouchers = [];
            }
            currentUser.vouchers.push({
                id: Date.now(),
                name: item.name,
                date: new Date().toLocaleString(),
                code: 'VIP' + Math.floor(Math.random() * 1000000)
            });
            
            alert(`成功兌換 ${item.name}！`);
            updateWalletDisplay();
            updateVipInfo();
        });
    });
});

// VIP刮刮樂
document.getElementById('scratchCardBtn').addEventListener('click', function() {
    if (!currentUser) return;
    
    // 檢查是否有刮刮樂次數
    if (currentUser.scratchCards === undefined) {
        currentUser.scratchCards = 3; // 初始3次
    }
    
    if (currentUser.scratchCards <= 0) {
        alert('今日刮刮樂次數已用完！');
        return;
    }
    
    currentUser.scratchCards--;
    
    // 隨機獎勵
    const prizes = [
        { name: '謝謝參與', points: 0 },
        { name: '100點', points: 100 },
        { name: '500點', points: 500 },
        { name: '1000點', points: 1000 },
        { name: '5000點', points: 5000 }
    ];
    
    const prize = prizes[Math.floor(Math.random() * prizes.length)];
    currentUser.points += prize.points;
    
    // 記錄交易
    if (prize.points > 0) {
        const transaction = {
            type: 'scratch_card',
            amount: prize.points,
            date: new Date().toLocaleString()
        };
        
        if (!currentUser.transactions) {
            currentUser.transactions = [];
        }
        currentUser.transactions.push(transaction);
    }
    
    alert(`刮刮樂結果: ${prize.name}${prize.points > 0 ? ' (' + prize.points + '點)' : ''}\n剩餘次數: ${currentUser.scratchCards}`);
    updateWalletDisplay();
});

// 更改密碼
document.getElementById('changePasswordBtn').addEventListener('click', function() {
    const oldPassword = prompt('請輸入舊密碼:');
    if (oldPassword !== currentUser.password) {
        alert('舊密碼不正確！');
        return;
    }
    
    const newPassword = prompt('請輸入新密碼:');
    if (!newPassword || newPassword.length < 6) {
        alert('密碼長度至少6位！');
        return;
    }
    
    const confirmPassword = prompt('請再次輸入新密碼:');
    if (newPassword !== confirmPassword) {
        alert('兩次輸入的密碼不一致！');
        return;
    }
    
    currentUser.password = newPassword;
    alert('密碼更改成功！');
});

// 輸入兌換碼
document.getElementById('redeemCodeBtn').addEventListener('click', function() {
    const code = prompt('請輸入兌換碼:');
    if (!code) return;
    
    // 檢查兌換碼是否有效
    const validCodes = ['VIP2023', 'WELCOME100', 'BONUS500'];
    if (validCodes.includes(code.toUpperCase())) {
        let points = 0;
        switch(code.toUpperCase()) {
            case 'VIP2023': points = 1000; break;
            case 'WELCOME100': points = 100; break;
            case 'BONUS500': points = 500; break;
        }
        
        currentUser.points += points;
        
        // 記錄交易
        const transaction = {
            type: 'redeem_code',
            code: code,
            amount: points,
            date: new Date().toLocaleString()
        };
        
        if (!currentUser.transactions) {
            currentUser.transactions = [];
        }
        currentUser.transactions.push(transaction);
        
        alert(`兌換成功！獲得 ${points} 點`);
        updateWalletDisplay();
    } else {
        alert('無效的兌換碼！');
    }
});

// AI客服
document.getElementById('aiChatBtn').addEventListener('click', function() {
    const questions = [
        { q: '如何獲得更多點數？', a: '您可以通過每日簽到、參與活動或購買來獲得更多點數。' },
        { q: 'VIP等級有什麼好處？', a: 'VIP等級越高，享受的優惠和特權越多，詳情請查看VIP等級說明。' },
        { q: '點數會過期嗎？', a: '不會，您的點數永久有效。' },
        { q: '如何聯繫客服？', a: '請發送郵件至 support@vipservice.com' }
    ];
    
    let questionHtml = '<h3>常見問題</h3>';
    questions.forEach((item, index) => {
        questionHtml += `
            <div class="ai-message ai-bot">
                <strong>Q${index + 1}: ${item.q}</strong><br>
                ${item.a}
            </div>
        `;
    });
    
    questionHtml += `
        <div class="ai-message ai-user">
            <input type="text" id="aiQuestionInput" placeholder="輸入您的問題...">
            <button id="askQuestionBtn">提問</button>
        </div>
    `;
    
    const container = document.createElement('div');
    container.innerHTML = questionHtml;
    alert(container.innerHTML);
    
    // 添加提問功能
    document.getElementById('askQuestionBtn').addEventListener('click', function() {
        const question = document.getElementById('aiQuestionInput').value.trim();
        if (!question) return;
        
        // 簡單的AI回答
        let answer = "感謝您的提問，我們的客服人員會盡快回覆您。";
        if (question.includes('點數')) {
            answer = "關於點數的問題，您可以通過簽到、兌換碼或參與活動獲得更多點數。";
        } else if (question.includes('VIP')) {
            answer = "VIP會員享有更多特權，請查看VIP等級說明了解詳情。";
        }
        
        alert(`問題: ${question}\n\n回答: ${answer}`);
    });
});

// 檢查更新
document.getElementById('checkUpdatesBtn').addEventListener('click', function() {
    document.getElementById('updateStatus').innerHTML = '檢查更新中...';
    
    // 模擬檢查更新
    setTimeout(() => {
        document.getElementById('updateStatus').innerHTML = `
            <p>當前版本: ${SYSTEM_CONFIG.version}</p>
            <p>最後更新: ${SYSTEM_CONFIG.lastUpdate}</p>
            <p style="color:green">您的系統已是最新版本！</p>
        `;
    }, 1500);
});

// 查看收件
document.getElementById('viewReceiptsBtn').addEventListener('click', function() {
    if (!currentUser.receipts || currentUser.receipts.length === 0) {
        alert('暫無收件記錄');
        return;
    }
    
    let receiptsHtml = '<h3>收件記錄</h3>';
    currentUser.receipts.forEach(receipt => {
        receiptsHtml += `
            <div class="announcement-item">
                <div class="announcement-content">
                    <strong>${receipt.title}</strong><br>
                    ${receipt.content}
                </div>
                <div class="announcement-date">
                    ${receipt.date}
                </div>
            </div>
        `;
    });
    
    alert(receiptsHtml);
});

// 查看發票
document.getElementById('viewInvoicesBtn').addEventListener('click', function() {
    if (!currentUser.invoices || currentUser.invoices.length === 0) {
        alert('暫無發票記錄');
        return;
    }
    
    let invoicesHtml = '<h3>發票記錄</h3>';
    currentUser.invoices.forEach(invoice => {
        invoicesHtml += `
            <div class="invoice-container">
                <div>發票號碼: ${invoice.number}</div>
                <div>金額: ${invoice.amount} 元</div>
                <div>日期: ${invoice.date}</div>
                <div>狀態: ${invoice.paid ? '已付款' : '未付款'}</div>
            </div>
        `;
    });
    
    alert(invoicesHtml);
});

// 生成商品券條碼
document.getElementById('generateBarcodeBtn').addEventListener('click', function() {
    if (!currentUser.vouchers || currentUser.vouchers.length === 0) {
        alert('您目前沒有可用的商品券');
        return;
    }
    
    let vouchersHtml = '<h3>選擇要生成條碼的商品券</h3>';
    currentUser.vouchers.forEach(voucher => {
        vouchersHtml += `
            <div class="voucher-item">
                <div>${voucher.name}</div>
                <div>券號: ${voucher.code}</div>
                <button class="generate-barcode-btn" data-code="${voucher.code}">
                    生成條碼
                </button>
            </div>
        `;
    });
    
    const container = document.createElement('div');
    container.innerHTML = vouchersHtml;
    alert(container.innerHTML);
    
    // 添加生成條碼事件
    document.querySelectorAll('.generate-barcode-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const code = this.getAttribute('data-code');
            alert(`條碼生成成功！\n\n券號: ${code}\n\n請向店員出示此頁面。`);
        });
    });
});

// 我的商品券
document.getElementById('viewVouchersBtn').addEventListener('click', function() {
    if (!currentUser.vouchers || currentUser.vouchers.length === 0) {
        alert('您目前沒有可用的商品券');
        return;
    }
    
    let vouchersHtml = '<h3>我的商品券</h3>';
    currentUser.vouchers.forEach(voucher => {
        vouchersHtml += `
            <div class="voucher-item">
                <div><strong>${voucher.name}</strong></div>
                <div>券號: ${voucher.code}</div>
                <div>獲取日期: ${voucher.date}</div>
            </div>
        `;
    });
    
    alert(vouchersHtml);
});

// 每日額外獎勵
document.getElementById('dailyBonusBtn').addEventListener('click', function() {
    if (!currentUser.isVip) {
        alert('此功能僅限VIP會員使用！');
        return;
    }
    
    const today = new Date().toLocaleDateString();
    if (currentUser.lastDailyBonus === today) {
        alert('您今天已經領取過每日額外獎勵了！');
        return;
    }
    
    const bonusPoints = 500; // VIP每日額外獎勵500點
    currentUser.points += bonusPoints;
    currentUser.lastDailyBonus = today;
    
    // 記錄交易
    const transaction = {
        type: 'daily_bonus',
        amount: bonusPoints,
        date: new Date().toLocaleString()
    };
    
    if (!currentUser.transactions) {
        currentUser.transactions = [];
    }
    currentUser.transactions.push(transaction);
    
    alert(`VIP每日額外獎勵領取成功！獲得 ${bonusPoints} 點`);
    updateWalletDisplay();
});

// 點數轉賬 (已實現)
// 已在之前的代碼中實現

// VIP專屬禮物
document.getElementById('vipGiftBtn').addEventListener('click', function() {
    if (!currentUser.isVip) {
        alert('此功能僅限VIP會員使用！');
        return;
    }
    
    const gifts = [
        { name: 'VIP專屬禮包', points: 0 },
        { name: 'VIP生日禮物', points: 0 },
        { name: 'VIP節日禮盒', points: 0 }
    ];
    
    const gift = gifts[Math.floor(Math.random() * gifts.length)];
    
    // 添加到商品券
    if (!currentUser.vouchers) {
        currentUser.vouchers = [];
    }
    currentUser.vouchers.push({
        id: Date.now(),
        name: gift.name,
        date: new Date().toLocaleString(),
        code: 'VIPGIFT' + Math.floor(Math.random() * 10000)
    });
    
    alert(`獲得VIP專屬禮物: ${gift.name}\n請到「我的商品券」查看。`);
});

// ================= 初始化函數 =================
function init() {
    // ... (原有初始化代碼)
    
    // 初始化用戶數據（如果沒有）
    Object.values(users).forEach(user => {
        if (!user.transactions) user.transactions = [];
        if (!user.vouchers) user.vouchers = [];
        if (!user.receipts) user.receipts = [];
        if (!user.invoices) user.invoices = [];
    });
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
